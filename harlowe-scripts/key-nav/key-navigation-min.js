/* Mali's key navigation for Harlowe */

window.KeyNav={symbols:["1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","k","r","s","t","u","v","w","x","y","z"],story:$("tw-story"),isInvalid:t=>t.ctrlKey||t.shiftKey||t.altKey||["INPUT","TEXTAREA"].includes(t.originalTarget.tagName)||t.originalTarget.hasAttribute("contenteditable"),historyControl(t){if("ArrowRight"===t.code){const t=this.story.find("tw-icon[title=Redo]:visible");if("hidden"!==t.css("visibility"))return t.click()}if("ArrowLeft"===t.code){const t=this.story.find("tw-icon[title=Undo]:visible");if("hidden"!==t.css("visibility"))return t.click()}return!1},process(t){if(!this._enabled||this.isInvalid(t))return;if(this.historyControl(t))return;let e=/Digit|Numpad/.test(t.code)?t.code.at(-1):t.key;if(!this.symbols.includes(e))return;const i=this.symbols.indexOf(e.toLowerCase()),s=this.story.find("tw-passage>:not(tw-sidebar) tw-link")[i];s&&s.click()},_enabled:!1,get enabled(){return this._enabled},set enabled(t){this._enabled=t=!!t,t?$("html")[0].setAttribute("data-keynav",""):$("html")[0].removeAttribute("data-keynav")}},KeyNav.enabled=!0,window.addEventListener("keyup",KeyNav.process.bind(KeyNav));