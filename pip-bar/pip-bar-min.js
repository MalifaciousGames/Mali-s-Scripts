((onPage=0)=>{const format=document.querySelector("tw-storydata").getAttribute("format"),varParser={SugarCube:e=>e.replace(/(?<!\w)\$(?=\w)/g,"State.variables.").replace(/(?<!\w)_(?=\w)/g,"State.temporary."),Harlowe:e=>e.replace(/(?<!\w)\$(?=\w)/g,"State.variables."),Chapbook(e){const t=engine.state.get();for(const s in t)e=e.replace(new RegExp(`\\b${s}\\b`,"g"),t[s]);return e}},config={name:"pip-bar",presets:{default:"◼,◻",round:"◉,◎",hexa:"⬢,⬡",hexalong:"⬣,⎔",penta:"⬟,⬠",pentalong:"⭓,⭔",diamond:"◈,◇",bar:"𝅛,𝅚",xcom:"▰,▱",sonata:"☐,☒",stars:"★,☆",stars4:"⯌,⯎",ascii:{full:"l",empty:{token:"l",style:"opacity: .5;"}},hearts:{full:"♡",empty:{token:"♡",style:"opacity: .5;"}}},classes:{full:"full-bar",empty:"empty-bar",main:"pip-bar"},default:{max:5,value:0}},numGetter=v=>{let num=Number(v);if(isNaN(num))try{num=eval(v)}catch{num=0}return"number"!=typeof num&&(num=0),num};function numSetter(e){return"number"==typeof e&&(e=""+e),isNaN(Number(e))&&!this.hasVariable&&(this.hasVariable=!0,onPage++),varParser[format]&&(e=varParser[format](e)),e}window.PipBar=class extends HTMLElement{constructor(){super(),this.preset="default",this.max=config.default.max,this.value=config.default.value,this.setAttribute("aria-live","polite")}get preset(){return this._preset}set preset(e){if("object"==typeof e)return"string"==typeof e.full&&(e.full={token:e.full}),"string"==typeof e.empty&&(e.empty={token:e.empty}),this._preset=e;if("string"==typeof e){if(config.presets[e])return this.preset=config.presets[e];const[t="",s=""]=e.split(",");this._preset={full:{token:t},empty:{token:s}}}}get value(){return Math.min(numGetter(this._value),this.max)}set value(e){this._value=numSetter.call(this,e)}get max(){return numGetter(this._max)}set max(e){this._max=numSetter.call(this,e)}connectedCallback(){this.firstInit||(this.baseText=this.innerHTML,this.firstInit=!0),this.printValue()}buildBar(e,t){const s=this.preset[t],a=s.token,r=config.classes[t]+(s?.class??""),i="".padEnd(e*a.length,a);return`<span class='${r}' style='${s?.style??""}'>${i}</span>`}printValue(){const e=this.value,t=this.max,s=e+" out of "+t;s!==this.excerpt&&(this.innerHTML=this.baseText+`<span class='${config.classes.main}'>`+this.buildBar(e,"full")+this.buildBar(t-e,"empty")+"</span>",this.setAttribute("aria-label",this.excerpt=s))}attributeChangedCallback(e,t,s){if(null!=s){if(e.includes("-")){const[t,a]=e.split("-");this.preset[t][a]=s}switch(e){case"preset":this.preset=s;break;case"tokens":const[t="",a=""]=s.split(",");this.preset.full.token=t,this.preset.empty.token=a;break;case"value":case"max":this[e]=s}this.isConnected&&this.printValue()}}static observedAttributes=["max","value","preset","full-token","empty-token","full-class","empty-class","full-style","empty-style","tokens"];static updateAll=()=>{const e=document.querySelectorAll("pip-bar");e.length||(onPage=0),onPage&&e.forEach((e=>{setTimeout((()=>{e.hasVariable&&e.printValue()}),20)}))}},customElements.define(config.name,PipBar),window.addEventListener("click",PipBar.updateAll,!0),window.addEventListener("keypress",(e=>{"Enter"===e.key&&PipBar.updateAll()}),!0)})();